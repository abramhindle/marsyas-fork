<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Marsyas: /home/hindle1/src/marsyas/src/marsyas/TmTimer.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Marsyas
   &#160;<span id="projectnumber">0.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_6680c0e66a1a8ddee45eaed69a14f44a.html">marsyas</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">TmTimer.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">** Copyright (C) 1998-2005 George Tzanetakis &lt;gtzan@cs.uvic.ca&gt;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">**  </span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">** This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">** it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">** the Free Software Foundation; either version 2 of the License, or</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">** (at your option) any later version.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">** </span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">** This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">** but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">** GNU General Public License for more details.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">** </span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">** You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">** along with this program; if not, write to the Free Software </span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">** Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="common__source_8h.html">common_source.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;TmTimer.h&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">using namespace </span>Marsyas;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">TmTimer::TmTimer()</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">{</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">    init();</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">TmTimer::TmTimer(mrs_string name)</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">{</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">    init();</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">    name_=name;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#ae66de57b00af61e602137f9a4f5ebb00">   35</a></span>&#160;TmTimer::TmTimer(std::string type, std::string name)</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;{</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    type_=type;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    name_=name;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        cur_time_=0;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    init();</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#a177f17e7a813fd4addfd37d69ade1565">   42</a></span>&#160;TmTimer::TmTimer(<span class="keyword">const</span> <a class="code" href="classMarsyas_1_1TmTimer.html" title="Base timer class must be overriden to create new concrete timers.">TmTimer</a>&amp; t)</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    name_=t.<a class="code" href="classMarsyas_1_1TmTimer.html#a4d739cc5d335052eb9f5b2ca559b81d1" title="given name identifier of the timer">name_</a>;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">//    granularity_=t.granularity_;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    type_=t.<a class="code" href="classMarsyas_1_1TmTimer.html#a82430191e59707c01706b4dcddde965a" title="type of the timer or class name">type_</a>;      <span class="comment">// Type of MarSystem</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    name_=t.<a class="code" href="classMarsyas_1_1TmTimer.html#a4d739cc5d335052eb9f5b2ca559b81d1" title="given name identifier of the timer">name_</a>;      <span class="comment">// Name of instance</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">//    next_trigger_=t.next_trigger_;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    cur_time_=t.<a class="code" href="classMarsyas_1_1TmTimer.html#af48197357aa7ab5803629a400268ccc0" title="the current time count">cur_time_</a>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">//    scheduler=t.scheduler;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;TmTimer::~TmTimer() { }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#a02fd73d861ef2e4aabb38c0c9ff82947">   56</a></span>&#160;TmTimer::init()</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;{</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">//    cur_time_=0;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">//    granularity_=0;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">//    next_trigger_=0;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;mrs_string</div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#a431737fe6c666ef01e2685212aa008c8">   64</a></span>&#160;TmTimer::getName()</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;{</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">return</span> name_;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;mrs_string</div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#a98bec083822fd9177b63b1db49c872fc">   70</a></span>&#160;TmTimer::getType()</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;{</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">return</span> type_;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;mrs_string</div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#a3bf8c4bd9c20520cf236ab415bc133ca">   76</a></span>&#160;TmTimer::getPrefix()</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;{</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">return</span> type_ + <span class="stringliteral">&quot;/&quot;</span> + name_;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;}</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;mrs_natural </div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#a094df656621dac31770dc62ca7db9063">   82</a></span>&#160;TmTimer::getTime()</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;{</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">return</span> cur_time_;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;}</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#a873dd91783f9efb4a590aded1f70d6b0">   88</a></span>&#160;TmTimer::tick()</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;{</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    updtime();</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    trigger();</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#adf40e6870558e73976edd29b81073eba">   95</a></span>&#160;TmTimer::updtime()</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;{</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="comment">// now update the time for the end of this time slot</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    mrs_natural adj_time = readTimeSrc();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">if</span> (adj_time&lt;1)</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    cur_time_ += adj_time;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#ab0554cb7241c0b72d34402f0bb419462">  104</a></span>&#160;<span class="keywordtype">void</span> TmTimer::trigger()</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;{</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    dispatch();</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#aa3b243bf7af4d12e5a5632415786067d">  110</a></span>&#160;TmTimer::updtimer(std::string cname, <a class="code" href="classMarsyas_1_1TmControlValue.html" title="TmControlValue is a simple parameter passing mechanism for updtimer.">TmControlValue</a> value)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;{</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    (void)cname; <span class="comment">// FIXME These values are unused</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    (void)value;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    std::string x = <span class="stringliteral">&quot;TmTimer::updtimer(\&quot;&quot;</span>+cname+<span class="stringliteral">&quot;\&quot;,&quot;</span>+value.<a class="code" href="classMarsyas_1_1TmControlValue.html#aacde1aabc882e278bde1c93b00087ae8" title="get the name of this value type.">getSType</a>()+<span class="stringliteral">&quot;)  updtimer not supported for this timer&quot;</span>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    MRSWARN(x);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#a2e6d6eaf84b472a51479b3678ab739fc">  119</a></span>&#160;TmTimer::updtimer(<a class="code" href="classMarsyas_1_1TmParam.html" title="TmParam associates a name with a value and is used for setting parameters of timers.">TmParam</a>&amp; param)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;{</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    updtimer(param.cname(),param.value());</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;}</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#a49db36a58da6609dde39773d253a8fe0">  125</a></span>&#160;TmTimer::updtimer(std::vector&lt;TmParam&gt; params)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;{</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    vector&lt;TmParam&gt;::const_iterator tvi;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="keywordflow">for</span>(tvi=params.begin(); tvi!=params.end(); ++tvi) {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <a class="code" href="classMarsyas_1_1TmParam.html" title="TmParam associates a name with a value and is used for setting parameters of timers.">TmParam</a> p = *tvi;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        updtimer(p);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    MRSWARN(<span class="stringliteral">&quot;TmTimer::updtimer(mrs_string,TmControlValue)  updtimer not supported for this timer&quot;</span>);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;}</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#abc9774d0a3c90125f945947cec8ba034">  136</a></span>&#160;TmTimer::post(std::string event_time, <a class="code" href="classMarsyas_1_1Repeat.html" title="encapsulates repetition information for scheduled events">Repeat</a> rep, <a class="code" href="classMarsyas_1_1EvEvent.html" title="EvEvent.">EvEvent</a>* ev)</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;{</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    rep--;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// should probably check if rep.count==0</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    mrs_natural stime = getTime() + intervalsize(event_time);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    ev-&gt;<a class="code" href="classMarsyas_1_1EvEvent.html#a128a97633333ccd54526e23379c66e48" title="set the time at which this event is to be dispatched">setTime</a>(stime);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    ev-&gt;<a class="code" href="classMarsyas_1_1EvEvent.html#a6a8126f650c668d4cb12646e5aef0e5e" title="set the repeat state of this event">setRepeat</a>(rep);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    post(ev);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;}</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00147"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#a947294e157652d44466a2b22710b7b1d">  147</a></span>&#160;TmTimer::post(std::string event_time, <a class="code" href="classMarsyas_1_1EvEvent.html" title="EvEvent.">EvEvent</a>* ev)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;{</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    mrs_natural stime = getTime() + intervalsize(event_time);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    ev-&gt;<a class="code" href="classMarsyas_1_1EvEvent.html#a128a97633333ccd54526e23379c66e48" title="set the time at which this event is to be dispatched">setTime</a>(stime);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    ev-&gt;<a class="code" href="classMarsyas_1_1EvEvent.html#a6a8126f650c668d4cb12646e5aef0e5e" title="set the repeat state of this event">setRepeat</a>(<a class="code" href="classMarsyas_1_1Repeat.html" title="encapsulates repetition information for scheduled events">Repeat</a>());</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    post(ev);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;}</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#ab01a4548a1944b53fb781f50e25d25e2">  156</a></span>&#160;TmTimer::post(<a class="code" href="classMarsyas_1_1EvEvent.html" title="EvEvent.">EvEvent</a>* ev)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;{</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    ev-&gt;<a class="code" href="classMarsyas_1_1EvEvent.html#afe8c35014dbec0a6ee3075ead234a26f" title="set the timer on which this event is scheduled. This method is called by the timer&#39;s post method when...">setTimer</a>(<span class="keyword">this</span>); <span class="comment">// for EvEpr type events that want to read the timer</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// add pointer to map</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    events_[ev-&gt;<a class="code" href="classMarsyas_1_1EvEvent.html#a0e030f17d410f819929d045acb959a3f" title="the prefix is a concatenation of type and name as &quot;type/name&quot;">getPrefix</a>()] = ev;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">// add to heap</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    pq_.push(ev);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;}</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keywordtype">bool</span></div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#abadc81d08281324fad8131b77133093e">  166</a></span>&#160;TmTimer::eventPending()</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;{</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">return</span> (!pq_.empty() &amp;&amp; pq_.top()-&gt;getTime()&lt;getTime());</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;}</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00172"></a><span class="lineno"><a class="code" href="classMarsyas_1_1TmTimer.html#a3bbf2feb28a23630cc3ade2c04337e4f">  172</a></span>&#160;TmTimer::dispatch()</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;{   <span class="comment">//if (getPrefix()==&quot;TmVirtualTime/neil&quot;) cout &lt;&lt; getTime() &lt;&lt; endl;</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">while</span> (eventPending()) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="comment">// dispatch</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <a class="code" href="classMarsyas_1_1EvEvent.html" title="EvEvent.">EvEvent</a>* ev = pq_.pop();</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        ev-&gt;<a class="code" href="classMarsyas_1_1EvEvent.html#a0f109f1a95c300f1a979a9d59f2c39d4" title="the action to be performed by the event. This method is called when the event is due. Since Marsyas is not threaded, this method will block so be careful not to do too much.">dispatch</a>();</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="comment">// handle repetition</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">if</span> (ev-&gt;<a class="code" href="classMarsyas_1_1EvEvent.html#ac7058264851b1479e01129febff7d689" title="report if the event is to be repeated">repeat</a>()) {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            ev-&gt;<a class="code" href="classMarsyas_1_1EvEvent.html#a2f91aa260290d8a6207499c48136da0e" title="force the event to update its dispatch time and decrement its repeat count based on the repetition in...">doRepeat</a>();</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            post(ev);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <span class="comment">// delete handle to event</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            events_iter_ = events_.find(ev-&gt;<a class="code" href="classMarsyas_1_1EvEvent.html#a0e030f17d410f819929d045acb959a3f" title="the prefix is a concatenation of type and name as &quot;type/name&quot;">getPrefix</a>());</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="keywordflow">if</span> (events_iter_ != events_.end()) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                events_.erase(events_iter_);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="keyword">delete</span>(ev);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;}</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">ostream&amp;</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">Marsyas::operator&lt;&lt; (ostream&amp; o, Scheduler&amp; sys) {</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">//    sys.put(o);</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">    return o;</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">}</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">*/</span></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Mar 24 2013 13:57:21 for Marsyas by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
